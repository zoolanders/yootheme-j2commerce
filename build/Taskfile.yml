# build tasks for the plugin
# Do not touch this file, it will be updated automatically.

version: '3'

tasks:
  build:
    cmds:
      - task: utils:copy
        vars:
          cwd: build/joomla
          src: '**'
          ignore: update.xml
          dest: dist/joomla

      - task: copy-module-joomla

      - task: placeholder-joomla

      - task: utils:zip
        vars:
          cwd: dist/joomla
          src: '**'
          dest: dist/{{.NAME}}-{{.VERSION}}.zip

      - defer:
          task: clear-dist-joomla

  copy-module-joomla:
    internal: true
    cmds:
      - task: utils:copy
        vars:
          src: modules/**
          dest: dist/joomla
          ignore: modules/*wordpress*/**

  placeholder-joomla:
    internal: true
    cmds:
      - task: utils:placeholder
        vars:
          src: 'dist/joomla/**/*.xml'
          replace:
            ref: >
              dict
              "TITLE" "{{.TITLE}}"
              "AUTHOR" "{{.AUTHOR}}"
              "AUTHORURL" "{{.AUTHORURL}}"
              "COPYRIGHT" "{{.COPYRIGHT}}"
              "DATE" "{{.DATE}}"
              "DESCRIPTION" "{{.DESCRIPTION}}"
              "LICENSE" "{{.LICENSE}}"
              "NAME" "{{.NAME}}"
              "VERSION" "{{.VERSION}}"

  clear-dist-joomla:
    internal: true
    cmds:
      - task: utils:remove
        vars:
          src: dist/joomla

  setup-joomla:
    cmds:
      - task: utils:copy
        vars:
          cwd: build/joomla
          src: '**'
          ignore: update.xml
          dest: dist/joomla

      - task: placeholder-joomla

      - task: utils:copy
        vars:
          cwd: dist/joomla
          src: '**'
          dest: ./

      - defer:
          task: clear-dist-joomla
